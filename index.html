<!DOCTYPE html>
<html lang="my">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debt Tracker</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="ကြွေးစာရင်း မှတ်တမ်း - Debt Tracking System">
    <meta name="theme-color" content="#FACC15">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Debt Tracker">

    <!-- Icons -->
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="manifest" href="site.webmanifest">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles/fonts.css">
    <link rel="stylesheet" href="styles/animations.css">
    <link rel="stylesheet" href="styles/brutalist.css">
    <link rel="stylesheet" href="styles/gradients.css">
    <link rel="stylesheet" href="styles/scrollbar.css">
    <link rel="stylesheet" href="styles/toast.css">
    <link rel="stylesheet" href="styles/dropdown.css">
    <link rel="stylesheet" href="styles/responsive.css">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="styles/datepicker.css">
    <link rel="stylesheet" href="styles/pin.css">
</head>

<body class="bg-white min-h-screen">
    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- App Container -->
    <div id="app" class="max-w-md mx-auto min-h-screen bg-white">

        <!-- Top Sticky Area: Header + Nav -->
        <div class="sticky top-0 z-40 bg-white pt-4 pb-2">
            <!-- Header -->
            <header class="gradient-yellow p-4 brutalist-card mb-3">
                <h1 class="text-2xl font-black text-center animate-bounce-once flex items-center justify-center gap-2">
                    <img src="images/logo.svg" alt="Logo" class="w-8 h-8">
                    Debt Tracking System
                </h1>
                <p class="text-center text-xs font-bold mt-1">ကြွေးစာရင်း မှတ်တမ်း</p>
            </header>

            <!-- Navigation -->
            <nav class="p-4 pt-0">
                <div class="grid grid-cols-4 gap-2 mb-2">
                    <button onclick="showView('dashboard')" class="nav-btn active py-2 text-xs" id="nav-dashboard">
                        📊<br>ပင်မစာမျက်နှာ
                    </button>
                    <button onclick="showView('customers')" class="nav-btn py-2 text-xs" id="nav-customers">
                        👥<br>ဖောက်သည်များ
                    </button>
                    <button onclick="showView('debts')" class="nav-btn py-2 text-xs" id="nav-debts">
                        📝<br>ကြွေးမှတ်ရန်
                    </button>
                    <button onclick="showView('payments')" class="nav-btn py-2 text-xs" id="nav-payments">
                        💰<br>ပြန်ဆပ်ငွေ မှတ်ရန်
                    </button>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="showView('settings')" class="nav-btn py-2 text-xs" id="nav-settings">
                        ⚙️<br>Settings
                    </button>
                    <button onclick="showView('lock')" class="nav-btn py-2 text-xs" id="nav-lock">
                        🔒<br>Lock ခတ်ရန်
                    </button>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <main class="p-4 pb-24 pt-4">

            <!-- Dashboard View -->
            <div id="view-dashboard" class="view-content">
                <!-- Date Filter -->
                <div class="brutalist-card bg-white p-4 mb-4">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-black text-sm">📅 ရက်စွဲအလိုက် စစ်ထုတ်ရန်</h3>
                        <button id="clear-dashboard-filter" class="text-xs font-bold text-blue-600 hidden"
                            onclick="clearDashboardFilter()">
                            ✕ ရှင်းမယ်
                        </button>
                    </div>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <button id="filter-today" onclick="applyDashboardFilter('today')"
                            class="dashboard-filter-btn brutalist-btn bg-blue-100 text-black py-2 text-xs font-bold">
                            ဒီနေ့
                        </button>
                        <button id="filter-yesterday" onclick="applyDashboardFilter('yesterday')"
                            class="dashboard-filter-btn brutalist-btn bg-blue-100 text-black py-2 text-xs font-bold">
                            မနေ့က
                        </button>
                        <button id="filter-week" onclick="applyDashboardFilter('week')"
                            class="dashboard-filter-btn brutalist-btn bg-blue-100 text-black py-2 text-xs font-bold">
                            ဒီအပတ်
                        </button>
                        <button id="filter-month" onclick="applyDashboardFilter('month')"
                            class="dashboard-filter-btn brutalist-btn bg-blue-100 text-black py-2 text-xs font-bold">
                            ဒီလ
                        </button>
                    </div>
                    <div class="text-xs font-bold mb-2">သို့မဟုတ် ရက်စွဲအပိုင်းအခြား ရွေးပါ:</div>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <input type="text" id="dashboard-start-date" placeholder="စတဲ့ရက်..."
                            class="brutalist-input w-full p-2 text-sm" style="font-family: Arial, sans-serif;">
                        <input type="text" id="dashboard-end-date" placeholder="ဆုံးရက်..."
                            class="brutalist-input w-full p-2 text-sm" style="font-family: Arial, sans-serif;">
                    </div>
                    <button onclick="applyDashboardFilter('custom')"
                        class="brutalist-btn bg-green-500 text-white w-full py-2 text-sm font-bold">
                        စစ်မယ်
                    </button>
                </div>

                <!-- Filter Status -->
                <div id="dashboard-filter-status"
                    class="hidden brutalist-card bg-yellow-100 border-3 border-yellow-600 p-3 mb-4">
                    <div class="flex items-center justify-between">
                        <div class="text-sm font-bold">
                            🔍 <span id="dashboard-filter-text"></span>
                        </div>
                    </div>
                </div>

                <!-- Metrics Cards -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="brutalist-card gradient-red p-4 metric-card animate-slideInUp">
                        <div class="text-xs font-bold mb-1">📉 ကြွေးကျန်စုစုပေါင်း</div>
                        <div class="text-2xl font-black" id="total-debt">0 Ks</div>
                    </div>
                    <div class="brutalist-card gradient-green p-4 metric-card animate-slideInUp"
                        style="animation-delay: 0.1s">
                        <div class="text-xs font-bold mb-1">💵 ဒီနေ့ရငွေ</div>
                        <div class="text-2xl font-black" id="today-payment">0 Ks</div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="brutalist-card gradient-blue p-4 metric-card animate-slideInUp"
                        style="animation-delay: 0.2s">
                        <div class="text-xs font-bold mb-1">👥 ဖောက်သည် ဦးရေ</div>
                        <div class="text-2xl font-black" id="total-customers">0</div>
                    </div>
                    <div class="brutalist-card gradient-purple p-4 metric-card animate-slideInUp"
                        style="animation-delay: 0.3s">
                        <div class="text-xs font-bold mb-1">📅 လစဉ်အကြွေး</div>
                        <div class="text-2xl font-black" id="month-debt">0 Ks</div>
                    </div>
                </div>

                <!-- Top Debtors -->
                <div class="brutalist-card gradient-orange p-4 mb-6 animate-slideInUp" style="animation-delay: 0.4s">
                    <h2 class="text-lg font-black mb-3 border-b-3 border-black pb-2">📈 အကြွေးအများဆုံး ဖောက်သည်များ
                    </h2>
                    <div id="top-debtors" class="space-y-2 max-h-60 overflow-y-auto hide-scrollbar">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Transactions -->
                <div class="brutalist-card bg-white p-4">
                    <h2 class="text-lg font-black mb-3 border-b-3 border-black pb-2">
                        <span id="transactions-title">🕐 ဒီနေ့ ပြန်ဆပ်ငွေစာရင်း</span>
                    </h2>
                    <div id="today-transactions" class="space-y-2 max-h-60 overflow-y-auto hide-scrollbar">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Customers View -->
            <div id="view-customers" class="view-content hidden">
                <!-- Add Customer Form -->
                <div class="brutalist-card gradient-yellow p-4 mb-6 animate-slideInUp">
                    <h2 class="text-lg font-black mb-3">➕ ဖောက်သည် အသစ်ထည့်မယ်</h2>
                    <form id="add-customer-form" class="space-y-3">
                        <input type="text" id="customer-name" placeholder="အမည် (ထည့်ရန်လို)"
                            class="brutalist-input w-full p-3" required>
                        <input type="tel" id="customer-phone" placeholder="ဖုန်းနံပါတ် (ရှိလျှင်ထည့်ပါ)"
                            class="brutalist-input w-full p-3">
                        <button type="submit" class="brutalist-btn bg-black text-white w-full py-3">
                            သိမ်းမယ်
                        </button>
                    </form>
                </div>

                <!-- Search -->
                <div class="mb-4">
                    <input type="text" id="customer-search" placeholder="🔍 နာမည်နဲ့ရှာပါ..."
                        class="brutalist-input w-full p-3">
                </div>

                <!-- Customer List -->
                <div id="customer-list" class="space-y-3 max-h-60 overflow-y-auto hide-scrollbar">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Debts View -->
            <div id="view-debts" class="view-content hidden">
                <!-- Add Debt Form -->
                <div class="brutalist-card gradient-pink p-4 mb-6 animate-slideInUp">
                    <h2 class="text-lg font-black mb-3">📝 ကြွေးအသစ်မှတ်မယ်</h2>
                    <form id="add-debt-form" class="space-y-3">
                        <div class="custom-dropdown" id="debt-customer-dropdown">
                            <button type="button" class="custom-dropdown-button brutalist-input w-full p-3 empty"
                                id="debt-customer-btn">
                                <span id="debt-customer-text">ဖောက်သည်ရွေးပါ</span>
                                <span class="dropdown-arrow">▼</span>
                            </button>
                            <div class="custom-dropdown-panel" id="debt-customer-panel">
                                <div class="custom-dropdown-search">
                                    <input type="text" id="debt-customer-search" placeholder="🔍 ရှာရန်..."
                                        class="w-full p-2 border-2 border-black font-bold" autocomplete="off">
                                </div>
                                <div class="custom-dropdown-list" id="debt-customer-list">
                                    <!-- Populated by JS -->
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="debt-customer" required>
                        <input type="text" id="debt-item" placeholder="မှတ်စုထည့်ပါ (ဥပမာ - မုန့် 2ထုပ် + ရေ 2ဗူး)"
                            class="brutalist-input w-full p-3" required>
                        <input type="number" id="debt-amount" placeholder="ပမာဏ ထည့်ပါ"
                            class="brutalist-input w-full p-3" min="0" required style="font-family: Arial, sans-serif;">
                        <div>
                            <label class="font-bold text-sm block mb-1">📅 ရက်စွဲ (Optional - ရက်မရွေးရင် ဒီနေ့ရက်စွဲနဲ့
                                မှတ်မှာဖြစ်ပါတယ်)</label>
                            <input type="text" id="debt-date" placeholder="ရက်စွဲရွေးပါ..."
                                class="brutalist-input w-full p-3" style="font-family: Arial, sans-serif;">
                        </div>
                        <button type="submit" class="brutalist-btn bg-black text-white w-full py-3">
                            သိမ်းမယ်
                        </button>
                    </form>
                </div>

                <!-- Recent Debts -->
                <div class="brutalist-card bg-white p-4">
                    <h2 class="text-lg font-black mb-3 border-b-3 border-black pb-2">📋 နောက်ဆုံးကြွေးမှတ်တမ်းများ</h2>
                    <!-- Debt Search -->
                    <div class="mb-4">
                        <input type="text" id="debt-search" placeholder="🔍 ဖောက်သည်နာမည်နဲ့ရှာပါ..."
                            class="brutalist-input w-full p-3">
                    </div>
                    <div id="recent-debts" class="space-y-3 max-h-60 overflow-y-auto hide-scrollbar">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Payments View -->
            <div id="view-payments" class="view-content hidden">
                <!-- Add Payment Form -->
                <div class="brutalist-card gradient-teal p-4 mb-6 animate-slideInUp">
                    <h2 class="text-lg font-black mb-3">💰ငွေရှင်းတာမှတ်မယ်</h2>
                    <form id="add-payment-form" class="space-y-3">
                        <div class="custom-dropdown" id="payment-customer-dropdown">
                            <button type="button" class="custom-dropdown-button brutalist-input w-full p-3 empty"
                                id="payment-customer-btn">
                                <span id="payment-customer-text">ဖောက်သည်ရွေးပါ</span>
                                <span class="dropdown-arrow">▼</span>
                            </button>
                            <div class="custom-dropdown-panel" id="payment-customer-panel">
                                <div class="custom-dropdown-search">
                                    <input type="text" id="payment-customer-search" placeholder="🔍 ရှာရန်..."
                                        class="w-full p-2 border-2 border-black font-bold" autocomplete="off">
                                </div>
                                <div class="custom-dropdown-list" id="payment-customer-list">
                                    <!-- Populated by JS -->
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="payment-customer" required>
                        <div class="brutalist-card bg-white p-3" id="customer-debt-info">
                            <span class="font-bold">ပေးရန်ကျန်ငွေ: </span>
                            <span class="text-xl font-black text-red-600" id="remaining-debt">0 Ks</span>
                        </div>
                        <input type="number" id="payment-amount" placeholder="ပေးမယ့်ပမာဏ"
                            class="brutalist-input w-full p-3" min="0" required style="font-family: Arial, sans-serif;">
                        <div>
                            <label class="font-bold text-sm block mb-1">📅 ရက်စွဲ (Optional - ရက်မရွေးရင် ဒီနေ့ရက်စွဲနဲ့
                                မှတ်မှာဖြစ်ပါတယ်)</label>
                            <input type="text" id="payment-date" placeholder="ရက်စွဲရွေးပါ..."
                                class="brutalist-input w-full p-3" style="font-family: Arial, sans-serif;">
                        </div>
                        <button type="submit" class="brutalist-btn bg-black text-white w-full py-3">
                            သိမ်းမယ်
                        </button>
                    </form>
                </div>

                <!-- Recent Payments -->
                <div class="brutalist-card bg-white p-4">
                    <h2 class="text-lg font-black mb-3 border-b-3 border-black pb-2">💵 နောက်ဆုံး ပြန်ဆပ်ငွေစာရင်း</h2>
                    <!-- Payment Search -->
                    <div class="mb-4">
                        <input type="text" id="payment-search" placeholder="🔍 ဖောက်သည်နာမည်နဲ့ရှာပါ..."
                            class="brutalist-input w-full p-3">
                    </div>
                    <div id="recent-payments" class="space-y-3 max-h-60 overflow-y-auto hide-scrollbar">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div id="view-settings" class="view-content hidden">
                <!-- Backup & Restore Card -->
                <div class="brutalist-card gradient-purple p-6 mb-6 animate-slideInUp">
                    <div class="text-center mb-6">
                        <div class="text-6xl mb-3">💾</div>
                        <h2 class="text-2xl font-black mb-2">Backup & Restore</h2>
                        <p class="font-bold text-sm text-gray-700">ဒေတာများ သိမ်းဆည်းခြင်း နှင့် ပြန်လည်ရယူခြင်း</p>
                    </div>

                    <div class="space-y-4">
                        <!-- Backup Section -->
                        <div class="brutalist-card bg-white p-4">
                            <h3 class="font-black text-lg mb-2 flex items-center gap-2">
                                📥 Backup Data
                            </h3>
                            <p class="text-sm font-bold text-gray-600 mb-3">
                                လက်ရှိ ဒေတာအားလုံးကို JSON ဖိုင်အဖြစ် ဒေါင်းလုဒ်လုပ်ပါ။
                            </p>
                            <button onclick="backupData()" class="brutalist-btn bg-blue-500 text-white w-full py-3">
                                💾 Backup လုပ်မယ်
                            </button>
                        </div>

                        <!-- Restore Section -->
                        <div class="brutalist-card bg-white p-4">
                            <h3 class="font-black text-lg mb-2 flex items-center gap-2">
                                📤 Restore Data
                            </h3>
                            <p class="text-sm font-bold text-gray-600 mb-3">
                                Backup လုပ်ထားသော ဖိုင်မှ ဒေတာများကို ပြန်လည်ရယူပါ။
                            </p>
                            <input type="file" id="restore-file" accept=".json" class="hidden">
                            <button onclick="document.getElementById('restore-file').click()"
                                class="brutalist-btn bg-green-500 text-white w-full py-3">
                                📂 Restore လုပ်မယ်
                            </button>
                        </div>

                        <!-- Warning Notice -->
                        <div class="brutalist-card bg-yellow-100 p-4 border-4 border-yellow-600">
                            <div class="flex gap-3">
                                <div class="text-2xl">⚠️</div>
                                <div>
                                    <p class="font-black text-sm mb-1">သတိပြုရန်</p>
                                    <p class="text-xs font-bold text-gray-700">
                                        Restore လုပ်ရင် လက်ရှိ ဒေတာအားလုံး ပျောက်သွားပြီး backup မှ ဒေတာများနဲ့
                                        အစားထိုးမှာ ဖြစ်ပါတယ်။
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Info -->
                <div class="brutalist-card bg-white p-4">
                    <h3 class="font-black text-lg mb-3 border-b-3 border-black pb-2">📊 ဒေတာအချက်အလက်</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between p-3 bg-blue-50 border-2 border-black">
                            <span class="font-bold">👥 ဖောက်သည်ဦးရေ</span>
                            <span class="font-black" id="settings-customers-count">0</span>
                        </div>
                        <div class="flex justify-between p-3 bg-red-50 border-2 border-black">
                            <span class="font-bold">📝 အကြွေးမှတ်တမ်း</span>
                            <span class="font-black" id="settings-debts-count">0</span>
                        </div>
                        <div class="flex justify-between p-3 bg-green-50 border-2 border-black">
                            <span class="font-bold">💰 ပြန်ဆပ်ငွေ မှတ်တမ်း</span>
                            <span class="font-black" id="settings-payments-count">0</span>
                        </div>
                    </div>
                </div>
                <!-- App Version -->
                <div class="text-center mt-6 mb-4">
                    <p class="text-xs font-bold text-gray-400">App Version: 1.4.0</p>
                </div>
            </div>

            <!-- Lock View -->
            <div id="view-lock" class="view-content hidden">
                <!-- Lock Status Card -->
                <div class="brutalist-card gradient-blue p-6 mb-6 animate-slideInUp">
                    <div class="text-center mb-6">
                        <div class="text-6xl mb-3">🔒</div>
                        <h2 class="text-2xl font-black mb-2">လုံခြုံရေး စနစ်</h2>
                        <p class="font-bold text-sm text-gray-700">PIN Lock System</p>
                    </div>

                    <!-- Lock Status -->
                    <div class="brutalist-card bg-white p-4 mb-4 text-center">
                        <div class="text-sm font-bold mb-2">Lock Status</div>
                        <div id="lock-status-display" class="lock-status-badge unlocked mx-auto">
                            🔓 PIN မသတ်မှတ်ရသေးပါ
                        </div>
                    </div>
                </div>

                <!-- PIN Management Card -->
                <div class="brutalist-card gradient-yellow p-6 mb-6 animate-slideInUp" style="animation-delay: 0.1s">
                    <h2 class="text-xl font-black mb-4 border-b-3 border-black pb-2">🔐 PIN Management</h2>

                    <div class="space-y-3">
                        <!-- Set PIN Button -->
                        <button id="btn-set-pin" onclick="showSetPINDialog()"
                            class="brutalist-btn bg-green-500 text-white w-full py-3 text-sm font-bold">
                            🔑 PIN သတ်မှတ်ရန်
                        </button>

                        <!-- Change PIN Button -->
                        <button id="btn-change-pin" onclick="showChangePINDialog()"
                            class="brutalist-btn bg-blue-500 text-white w-full py-3 text-sm font-bold" disabled>
                            🔄 PIN ပြောင်းရန်
                        </button>

                        <!-- Remove PIN Button -->
                        <button id="btn-remove-pin" onclick="showRemovePINDialog()"
                            class="brutalist-btn bg-red-500 text-white w-full py-3 text-sm font-bold" disabled>
                            🗑️ PIN ဖျက်ရန်
                        </button>
                    </div>
                </div>

                <!-- Info Card -->
                <div class="brutalist-card bg-white p-4 animate-slideInUp" style="animation-delay: 0.2s">
                    <h3 class="font-black text-lg mb-3 border-b-3 border-black pb-2">ℹ️ အချက်အလက်</h3>
                    <div class="space-y-2 text-sm font-bold">
                        <div class="flex items-start gap-2">
                            <span>•</span>
                            <span>App ဖွင့်တိုင်း PIN ရိုက်ရမယ်</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span>•</span>
                            <span>Backup Restore လုပ်ရင် PIN လိုအပ်မယ်</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span>•</span>
                            <span>PIN က 4 လုံး ဖြစ်ပါတယ်</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span>•</span>
                            <span>3 ကြိမ် မှားရင် 30 စက္ကန့် စောင့်ရမယ်</span>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Customer Detail Modal -->
    <div id="customer-modal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 p-4 overflow-y-auto modal-backdrop">
        <div class="max-w-md mx-auto mt-10 mb-10">
            <div class="brutalist-card bg-white p-6">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex-1">
                        <h2 class="text-xl font-black" id="modal-customer-name"></h2>
                        <p class="font-bold" id="modal-customer-phone"></p>
                    </div>
                    <div class="flex gap-2 items-start">
                        <button onclick="editCustomer()"
                            class="brutalist-btn bg-blue-400 text-white px-3 py-2 text-xs">✏️ Edit</button>
                        <button onclick="deleteCustomer()"
                            class="brutalist-btn bg-red-400 text-white px-3 py-2 text-xs">🗑️ Del</button>
                        <button onclick="closeModal()"
                            class="brutalist-btn bg-gray-400 text-white px-3 py-2 text-xs">✕</button>
                    </div>
                </div>
                <div class="brutalist-card bg-red-100 p-4 mb-4">
                    <div class="text-sm font-bold mb-1">စုစုပေါင်းကြွေးကျန်</div>
                    <div class="text-3xl font-black text-red-600" id="modal-total-debt">0 Ks</div>
                </div>
                <div class="mb-4">
                    <h3 class="font-black mb-2 text-lg border-b-3 border-black pb-2">အကြွေးယူမှုစာရင်း</h3>
                    <div id="modal-debts" class="space-y-2 max-h-32 overflow-y-auto hide-scrollbar"></div>
                </div>
                <div>
                    <h3 class="font-black mb-2 text-lg border-b-3 border-black pb-2">ပြန်ဆပ်ငွေမှတ်တမ်း</h3>
                    <div id="modal-payments" class="space-y-2 max-h-32 overflow-y-auto hide-scrollbar"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Customer Modal -->
    <div id="edit-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-[60] p-4 modal-backdrop">
        <div class="max-w-sm mx-auto mt-20">
            <div class="brutalist-card gradient-blue p-6">
                <h2 class="text-xl font-black mb-4 text-center">✏️ ဖောက်သည် အချက်အလက်ပြင်ဆင်ရန်</h2>
                <form id="edit-customer-form" class="space-y-3">
                    <input type="hidden" id="edit-customer-id">
                    <div>
                        <label class="font-bold text-sm block mb-1">အမည်</label>
                        <input type="text" id="edit-customer-name" class="brutalist-input w-full p-3" required>
                    </div>
                    <div>
                        <label class="font-bold text-sm block mb-1">ဖုန်းနံပါတ်</label>
                        <input type="tel" id="edit-customer-phone" class="brutalist-input w-full p-3">
                    </div>
                    <div class="flex gap-2 pt-2">
                        <button type="submit" class="brutalist-btn bg-green-500 text-white w-full py-3">✅
                            သိမ်းမယ်</button>
                        <button type="button" onclick="closeEditModal()"
                            class="brutalist-btn bg-gray-400 text-white w-full py-3">❌ မလုပ်တော့ဘူး</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-[60] p-4 modal-backdrop">
        <div class="max-w-sm mx-auto mt-20">
            <div class="brutalist-card gradient-red p-6">
                <div class="text-center mb-4">
                    <div class="text-6xl mb-3">⚠️</div>
                    <h2 class="text-xl font-black mb-2">သတိပေးချက်!</h2>
                    <p class="font-bold text-sm">ဒီဖောက်သည်ကို ဖျက်ပစ်မှာ သေချာပါသလား?</p>
                </div>
                <div class="brutalist-card bg-white p-3 mb-4">
                    <div class="font-black" id="delete-customer-name"></div>
                    <div class="font-bold text-sm text-gray-600" id="delete-customer-phone"></div>
                </div>
                <div class="bg-yellow-100 border-3 border-black p-3 mb-4">
                    <p class="text-xs font-bold text-center">⚠️ ဖောက်သည်ကို ဖျက်လိုက်ရင် သူနဲ့ ပတ်သက်တဲ့ ကြွေးစာရင်းတွေ၊
                        ငွေရှင်းမှတ်တမ်းတွေ အားလုံး ပျောက်သွားမှာပါ!</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="confirmDelete()" class="brutalist-btn bg-red-600 text-white w-full py-3">🗑️
                        ဖျက်ပစ်မယ်</button>
                    <button onclick="closeDeleteModal()" class="brutalist-btn bg-gray-400 text-white w-full py-3">❌
                        မဖျက်တော့ဘူး</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Debt Modal -->
    <div id="edit-debt-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-[60] p-4 modal-backdrop">
        <div class="max-w-sm mx-auto mt-20">
            <div class="brutalist-card gradient-pink p-6">
                <h2 class="text-xl font-black mb-4 text-center">✏️ ကြွေးစာရင်း ပြင်မယ်</h2>
                <form id="edit-debt-form" class="space-y-3">
                    <input type="hidden" id="edit-debt-id">
                    <div>
                        <label class="font-bold text-sm block mb-1">ဖောက်သည်</label>
                        <div class="brutalist-card bg-white p-3" id="edit-debt-customer-name"></div>
                    </div>
                    <div>
                        <label class="font-bold text-sm block mb-1">မှတ်စု</label>
                        <input type="text" id="edit-debt-item" class="brutalist-input w-full p-3" required>
                    </div>
                    <div>
                        <label class="font-bold text-sm block mb-1">ပမာဏ (Ks)</label>
                        <input type="number" id="edit-debt-amount" class="brutalist-input w-full p-3" min="0" required
                            style="font-family: Arial, sans-serif;">
                    </div>
                    <div>
                        <label class="font-bold text-sm block mb-1">📅 ရက်စွဲ</label>
                        <input type="text" id="edit-debt-date" placeholder="ရက်စွဲရွေးပါ..."
                            class="brutalist-input w-full p-3" style="font-family: Arial, sans-serif;">
                    </div>
                    <div class="flex gap-2 pt-2">
                        <button type="submit" class="brutalist-btn bg-green-500 text-white w-full py-3">✅
                            သိမ်းမယ်</button>
                        <button type="button" onclick="closeEditDebtModal()"
                            class="brutalist-btn bg-gray-400 text-white w-full py-3">❌ မလုပ်တော့ဘူး</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Debt Modal -->
    <div id="delete-debt-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-[60] p-4 modal-backdrop">
        <div class="max-w-sm mx-auto mt-20">
            <div class="brutalist-card gradient-red p-6">
                <div class="text-center mb-4">
                    <div class="text-6xl mb-3">⚠️</div>
                    <h2 class="text-xl font-black mb-2">သတိပေးချက်</h2>
                    <p class="font-bold text-sm">ဒီအကြွေးမှတ်တမ်းကို ဖျက်မှာ သေချာလား?</p>
                </div>
                <div class="brutalist-card bg-white p-3 mb-4" id="delete-debt-summary"></div>
                <div class="flex gap-2">
                    <button onclick="confirmDeleteDebt()" class="brutalist-btn bg-red-600 text-white w-full py-3">🗑️
                        ဖျက်မယ်</button>
                    <button onclick="closeDeleteDebtModal()" class="brutalist-btn bg-gray-400 text-white w-full py-3">❌
                        မဖျက်တော့ဘူး</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Payment Modal -->
    <div id="edit-payment-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-[60] p-4 modal-backdrop">
        <div class="max-w-sm mx-auto mt-20">
            <div class="brutalist-card gradient-teal p-6">
                <h2 class="text-xl font-black mb-4 text-center">✏️ ငွေရှင်းစာရင်း ပြင်မယ်</h2>
                <form id="edit-payment-form" class="space-y-3">
                    <input type="hidden" id="edit-payment-id">
                    <div>
                        <label class="font-bold text-sm block mb-1">ဖောက်သည်</label>
                        <div class="brutalist-card bg-white p-3" id="edit-payment-customer-name"></div>
                    </div>
                    <div>
                        <label class="font-bold text-sm block mb-1">ပမာဏ (Ks)</label>
                        <input type="number" id="edit-payment-amount" class="brutalist-input w-full p-3" min="0"
                            required style="font-family: Arial, sans-serif;">
                    </div>
                    <div>
                        <label class="font-bold text-sm block mb-1">📅 ရက်စွဲ</label>
                        <input type="text" id="edit-payment-date" placeholder="ရက်စွဲရွေးပါ..."
                            class="brutalist-input w-full p-3" style="font-family: Arial, sans-serif;">
                    </div>
                    <div class="flex gap-2 pt-2">
                        <button type="submit" class="brutalist-btn bg-green-500 text-white w-full py-3">✅
                            သိမ်းမယ်</button>
                        <button type="button" onclick="closeEditPaymentModal()"
                            class="brutalist-btn bg-gray-400 text-white w-full py-3">❌ မလုပ်တော့ဘူး</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Payment Modal -->
    <div id="delete-payment-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-[60] p-4 modal-backdrop">
        <div class="max-w-sm mx-auto mt-20">
            <div class="brutalist-card gradient-red p-6">
                <div class="text-center mb-4">
                    <div class="text-6xl mb-3">⚠️</div>
                    <h2 class="text-xl font-black mb-2">ငွေရှင်းမှတ်တမ်း ဖျက်မလား?</h2>
                    <p class="font-bold text-sm">ဒီငွေရှင်းမှတ်တမ်းကို ဖျက်မလား သေချာအောင် စဉ်းစားကြည့်ပါ။</p>
                </div>
                <div class="brutalist-card bg-white p-3 mb-4" id="delete-payment-summary"></div>
                <div class="flex gap-2">
                    <button onclick="confirmDeletePayment()" class="brutalist-btn bg-red-600 text-white w-full py-3">🗑️
                        ဖျက်မယ်</button>
                    <button onclick="closeDeletePaymentModal()"
                        class="brutalist-btn bg-gray-400 text-white w-full py-3">❌ မဖျက်တော့ဘူး</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Restore Confirmation Modal -->
    <div id="restore-modal"
        class="hidden fixed inset-0 bg-black bg-opacity-60 z-[60] p-4 overflow-y-auto modal-backdrop">
        <div class="max-w-md mx-auto mt-10 mb-10">
            <div class="brutalist-card gradient-blue p-6">
                <div class="text-center mb-4">
                    <div class="text-6xl mb-3">🌐</div>
                    <h2 class="text-xl font-black mb-2">Backup Data ကို Restore လုပ်မလား?</h2>
                </div>

                <!-- Backup Info -->
                <div class="brutalist-card bg-white p-4 mb-4">
                    <div class="text-sm font-bold mb-3 border-b-2 border-black pb-2">📋 Backup အချက်အလက်</div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="font-bold">📅 Backup ရက်စွဲ:</span>
                            <span class="font-black" id="restore-backup-date">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-bold">👥 ဖောက်သည်:</span>
                            <span class="font-black text-blue-600" id="restore-customers-count">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-bold">📝 ကြွေးမှတ်တမ်း:</span>
                            <span class="font-black text-red-600" id="restore-debts-count">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-bold">💰 ငွေရှင်းမှတ်တမ်း:</span>
                            <span class="font-black text-green-600" id="restore-payments-count">0</span>
                        </div>
                    </div>
                </div>

                <!-- Warning -->
                <div class="brutalist-card bg-yellow-100 border-4 border-yellow-600 p-4 mb-4">
                    <div class="flex gap-3">
                        <div class="text-2xl">⚠️</div>
                        <div>
                            <p class="font-black text-sm mb-1">သတိပြုရန်!</p>
                            <p class="text-xs font-bold text-gray-700">
                                လက်ရှိ ဒေတာအားလုံး ပျောက်သွားပြီး backup မှ ဒေတာများနဲ့ အစားထိုးမှာပါ။ ဆက်လုပ်မလား?
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="flex gap-2">
                    <button onclick="confirmRestore()" class="brutalist-btn bg-green-600 text-white w-full py-3">✅
                        OK</button>
                    <button onclick="closeRestoreModal()" class="brutalist-btn bg-gray-400 text-white w-full py-3">❌
                        Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Flatpickr JS -->
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-[60] p-4 modal-backdrop">
        <div class="max-w-sm mx-auto mt-20">
            <div class="brutalist-card gradient-red p-6">
                <div class="text-center mb-4">
                    <div class="text-6xl mb-3">⚠️</div>
                    <h2 class="text-xl font-black mb-2">သတိပေးချက်!</h2>
                    <p class="font-bold text-sm">ဒီဖောက်သည်ကို ဖျက်ပစ်မှာ သေချာပါသလား?</p>
                </div>
                <div class="brutalist-card bg-white p-3 mb-4">
                    <div class="font-black" id="delete-customer-name"></div>
                    <div class="font-bold text-sm text-gray-600" id="delete-customer-phone"></div>
                </div>
                <div class="bg-yellow-100 border-3 border-black p-3 mb-4">
                    <p class="text-xs font-bold text-center">⚠️ ဖောက်သည်ကို ဖျက်လိုက်ရင် သူနဲ့ ပတ်သက်တဲ့ ကြွေးစာရင်းတွေ၊
                        ငွေရှင်းမှတ်တမ်းတွေ အားလုံး ပျောက်သွားမှာပါ!</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="confirmDelete()" class="brutalist-btn bg-red-600 text-white w-full py-3">🗑️
                        ဖျက်ပစ်မယ်</button>
                    <button onclick="closeDeleteModal()" class="brutalist-btn bg-gray-400 text-white w-full py-3">❌
                        မဖျက်တော့ဘူး</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Debt Modal -->
    <div id="edit-debt-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-[60] p-4 modal-backdrop">
        <div class="max-w-sm mx-auto mt-20">
            <div class="brutalist-card gradient-pink p-6">
                <h2 class="text-xl font-black mb-4 text-center">✏️ ကြွေးစာရင်း ပြင်မယ်</h2>
                <form id="edit-debt-form" class="space-y-3">
                    <input type="hidden" id="edit-debt-id">
                    <div>
                        <label class="font-bold text-sm block mb-1">ဖောက်သည်</label>
                        <div class="brutalist-card bg-white p-3" id="edit-debt-customer-name"></div>
                    </div>
                    <div>
                        <label class="font-bold text-sm block mb-1">မှတ်စု</label>
                        <input type="text" id="edit-debt-item" class="brutalist-input w-full p-3" required>
                    </div>
                    <div>
                        <label class="font-bold text-sm block mb-1">ပမာဏ (Ks)</label>
                        <input type="number" id="edit-debt-amount" class="brutalist-input w-full p-3" min="0" required
                            style="font-family: Arial, sans-serif;">
                    </div>
                    <div>
                        <label class="font-bold text-sm block mb-1">📅 ရက်စွဲ</label>
                        <input type="text" id="edit-debt-date" placeholder="ရက်စွဲရွေးပါ..."
                            class="brutalist-input w-full p-3" style="font-family: Arial, sans-serif;">
                    </div>
                    <div class="flex gap-2 pt-2">
                        <button type="submit" class="brutalist-btn bg-green-500 text-white w-full py-3">✅
                            သိမ်းမယ်</button>
                        <button type="button" onclick="closeEditDebtModal()"
                            class="brutalist-btn bg-gray-400 text-white w-full py-3">❌ မလုပ်တော့ဘူး</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Debt Modal -->
    <div id="delete-debt-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-[60] p-4 modal-backdrop">
        <div class="max-w-sm mx-auto mt-20">
            <div class="brutalist-card gradient-red p-6">
                <div class="text-center mb-4">
                    <div class="text-6xl mb-3">⚠️</div>
                    <h2 class="text-xl font-black mb-2">သတိပေးချက်</h2>
                    <p class="font-bold text-sm">ဒီအကြွေးမှတ်တမ်းကို ဖျက်မှာ သေချာလား?</p>
                </div>
                <div class="brutalist-card bg-white p-3 mb-4" id="delete-debt-summary"></div>
                <div class="flex gap-2">
                    <button onclick="confirmDeleteDebt()" class="brutalist-btn bg-red-600 text-white w-full py-3">🗑️
                        ဖျက်မယ်</button>
                    <button onclick="closeDeleteDebtModal()" class="brutalist-btn bg-gray-400 text-white w-full py-3">❌
                        မဖျက်တော့ဘူး</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Payment Modal -->
    <div id="edit-payment-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-[60] p-4 modal-backdrop">
        <div class="max-w-sm mx-auto mt-20">
            <div class="brutalist-card gradient-teal p-6">
                <h2 class="text-xl font-black mb-4 text-center">✏️ ငွေရှင်းစာရင်း ပြင်မယ်</h2>
                <form id="edit-payment-form" class="space-y-3">
                    <input type="hidden" id="edit-payment-id">
                    <div>
                        <label class="font-bold text-sm block mb-1">ဖောက်သည်</label>
                        <div class="brutalist-card bg-white p-3" id="edit-payment-customer-name"></div>
                    </div>
                    <div>
                        <label class="font-bold text-sm block mb-1">ပမာဏ (Ks)</label>
                        <input type="number" id="edit-payment-amount" class="brutalist-input w-full p-3" min="0"
                            required style="font-family: Arial, sans-serif;">
                    </div>
                    <div>
                        <label class="font-bold text-sm block mb-1">📅 ရက်စွဲ</label>
                        <input type="text" id="edit-payment-date" placeholder="ရက်စွဲရွေးပါ..."
                            class="brutalist-input w-full p-3" style="font-family: Arial, sans-serif;">
                    </div>
                    <div class="flex gap-2 pt-2">
                        <button type="submit" class="brutalist-btn bg-green-500 text-white w-full py-3">✅
                            သိမ်းမယ်</button>
                        <button type="button" onclick="closeEditPaymentModal()"
                            class="brutalist-btn bg-gray-400 text-white w-full py-3">❌ မလုပ်တော့ဘူး</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Payment Modal -->
    <div id="delete-payment-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-[60] p-4 modal-backdrop">
        <div class="max-w-sm mx-auto mt-20">
            <div class="brutalist-card gradient-red p-6">
                <div class="text-center mb-4">
                    <div class="text-6xl mb-3">⚠️</div>
                    <h2 class="text-xl font-black mb-2">ငွေရှင်းမှတ်တမ်း ဖျက်မလား?</h2>
                    <p class="font-bold text-sm">ဒီငွေရှင်းမှတ်တမ်းကို ဖျက်မလား သေချာအောင် စဉ်းစားကြည့်ပါ။</p>
                </div>
                <div class="brutalist-card bg-white p-3 mb-4" id="delete-payment-summary"></div>
                <div class="flex gap-2">
                    <button onclick="confirmDeletePayment()" class="brutalist-btn bg-red-600 text-white w-full py-3">🗑️
                        ဖျက်မယ်</button>
                    <button onclick="closeDeletePaymentModal()"
                        class="brutalist-btn bg-gray-400 text-white w-full py-3">❌ မဖျက်တော့ဘူး</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Restore Confirmation Modal -->
    <div id="restore-modal"
        class="hidden fixed inset-0 bg-black bg-opacity-60 z-[60] p-4 overflow-y-auto modal-backdrop">
        <div class="max-w-md mx-auto mt-10 mb-10">
            <div class="brutalist-card gradient-blue p-6">
                <div class="text-center mb-4">
                    <div class="text-6xl mb-3">🌐</div>
                    <h2 class="text-xl font-black mb-2">Backup Data ကို Restore လုပ်မလား?</h2>
                </div>

                <!-- Backup Info -->
                <div class="brutalist-card bg-white p-4 mb-4">
                    <div class="text-sm font-bold mb-3 border-b-2 border-black pb-2">📋 Backup အချက်အလက်</div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="font-bold">📅 Backup ရက်စွဲ:</span>
                            <span class="font-black" id="restore-backup-date">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-bold">👥 ဖောက်သည်:</span>
                            <span class="font-black text-blue-600" id="restore-customers-count">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-bold">📝 ကြွေးမှတ်တမ်း:</span>
                            <span class="font-black text-red-600" id="restore-debts-count">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-bold">💰 ငွေရှင်းမှတ်တမ်း:</span>
                            <span class="font-black text-green-600" id="restore-payments-count">0</span>
                        </div>
                    </div>
                </div>

                <!-- Warning -->
                <div class="brutalist-card bg-yellow-100 border-4 border-yellow-600 p-4 mb-4">
                    <div class="flex gap-3">
                        <div class="text-2xl">⚠️</div>
                        <div>
                            <p class="font-black text-sm mb-1">သတိပြုရန်!</p>
                            <p class="text-xs font-bold text-gray-700">
                                လက်ရှိ ဒေတာအားလုံး ပျောက်သွားပြီး backup မှ ဒေတာများနဲ့ အစားထိုးမှာပါ။ ဆက်လုပ်မလား?
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="flex gap-2">
                    <button onclick="confirmRestore()" class="brutalist-btn bg-green-600 text-white w-full py-3">✅
                        OK</button>
                    <button onclick="closeRestoreModal()" class="brutalist-btn bg-gray-400 text-white w-full py-3">❌
                        Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script src="scripts/utils.js"></script>
    <script src="scripts/storage.js"></script>
    <script src="scripts/pin.js"></script>
    <script src="scripts/pin-ui.js"></script>
    <script src="scripts/customers.js"></script>
    <script src="scripts/debts.js"></script>
    <script src="scripts/payments.js"></script>
    <script src="scripts/dashboard.js"></script>
    <script src="scripts/modals.js"></script>
    <script src="scripts/dropdown.js"></script>
    <script src="scripts/settings.js"></script>
    <script src="scripts/app.js"></script>

    <!-- PWA Service Worker Registration & Update Logic -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').then(registration => {
                    console.log('Service Worker registered:', registration.scope);

                    // Check for updates immediately
                    registration.update();

                    // Listen for new service worker installation
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // New update available
                                showUpdateToast();
                            }
                        });
                    });
                }).catch(error => {
                    console.log('Service Worker registration failed:', error);
                });

                // Handle controller change (when new SW takes over)
                let refreshing;
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    if (refreshing) return;
                    window.location.reload();
                    refreshing = true;
                });
            });
        }

        function showUpdateToast() {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-4 left-4 right-4 bg-black text-white p-4 rounded-lg shadow-lg z-50 flex justify-between items-center animate-slideInUp';
            toast.innerHTML = `
                <div>
                    <p class="font-bold text-sm">Update Available! 🚀</p>
                    <p class="text-xs text-gray-300">ဗားရှင်းအသစ် ရပါပြီ။</p>
                </div>
                <button onclick="updateApp()" class="bg-yellow-400 text-black px-3 py-1 rounded font-bold text-xs">
                    Update
                </button>
            `;
            document.body.appendChild(toast);
        }

        function updateApp() {
            if (navigator.serviceWorker.controller) {
                // Send message to SW to skip waiting
                navigator.serviceWorker.controller.postMessage({ type: 'SKIP_WAITING' });
                // Also try to re-register to trigger update
                navigator.serviceWorker.getRegistration().then(reg => {
                    if (reg && reg.waiting) {
                        reg.waiting.postMessage({ type: 'SKIP_WAITING' });
                    }
                });
                window.location.reload();
            }
        }
    </script>
</body>

</html>